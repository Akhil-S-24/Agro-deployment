<!DOCTYPE html>
<html>
<head>
    <title>Dashboard - Agriculture System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)),
                        url('/uploads/WhatsApp_Image_2025-06-06_at_10.15.33_PM.jpeg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #333;
        }
        .header {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        .welcome {
            font-size: 24px;
        }
        .logout-button {
            background-color: #e74c3c;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            transition: background-color 0.3s;
        }
        .logout-button:hover {
            background-color: #c0392b;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        .menu {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .menu-item {
            background-color: #3498db;
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            text-decoration: none;
            text-align: center;
            min-width: 200px;
        }
        .menu-item:hover {
            background-color: #2980b9;
        }
        .content-area {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
            min-height: 400px;
        }
        .card {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #34495e;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .button {
            background-color: #27ae60;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            width: 100%;
        }
        .button:hover {
            background-color: #219a52;
        }
        .details-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .details-section h5 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 10px;
            border-bottom: 2px solid #27ae60;
            padding-bottom: 5px;
        }
        .chart-container {
            width: 100%;
            max-width: 600px;
            margin: 20px auto;
        }
        .hidden {
            display: none;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="header"> <center></center>
        <div class="welcome">Welcome to Agriculture System</div>
        <a href="/logout" class="logout-button">Logout</a>
    </div>

    <div class="container">
        <div class="menu">
            <button class="menu-item" onclick="showFeature('crop-recommendation')">Crop Recommendation</button>
            <button class="menu-item" onclick="showFeature('rain-prediction')">Rain Prediction</button>
            <button class="menu-item" onclick="showFeature('crop-details')">Crop Details</button>
            <button class="menu-item" onclick="showFeature('disease-detection')">Disease Detection</button>
            <button class="menu-item" onclick="showFeature('cost-estimator')">Cost Estimator</button>
            <button class="menu-item" onclick="showFeature('plant-health')">Plant Health</button>
        </div>

        <div class="content-area">
            <!-- Crop Recommendation Section -->
            <div id="crop-recommendation" class="feature-section hidden">
                <div class="card">
                    <h2>Crop Recommendation</h2>
                    <form id="cropRecommendationForm">
                        <div class="form-group">
                            <label for="nitrogen">Nitrogen (N):</label>
                            <input type="number" id="nitrogen" required min="0" max="140" step="1">
                        </div>
                        <div class="form-group">
                            <label for="phosphorus">Phosphorus (P):</label>
                            <input type="number" id="phosphorus" required min="0" max="145" step="1">
                        </div>
                        <div class="form-group">
                            <label for="potassium">Potassium (K):</label>
                            <input type="number" id="potassium" required min="0" max="205" step="1">
                        </div>
                        <div class="form-group">
                            <label for="temperature">Temperature (°C):</label>
                            <input type="number" id="temperature" required min="8" max="44" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="humidity">Humidity (%):</label>
                            <input type="number" id="humidity" required min="14" max="100" step="1">
                        </div>
                        <div class="form-group">
                            <label for="ph">pH:</label>
                            <input type="number" id="ph" required min="3.5" max="10" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="rainfall">Rainfall (mm):</label>
                            <input type="number" id="rainfall" required min="20" max="300" step="1">
                        </div>
                        <button type="submit" class="button">Get Recommendation</button>
                    </form>
                </div>
                <div id="cropRecommendationResult" class="card hidden">
                    <h3>Recommendation Results</h3>
                    <div id="recommendationContent"></div>
                    <div class="chart-container">
                        <canvas id="soilChart"></canvas>
                    </div>
                    </div>
                </div>

            <!-- Rain Prediction Section -->
            <div id="rain-prediction" class="feature-section hidden">
                <div class="card">
                    <h2>Rain Prediction</h2>
                    <form id="rainPredictionForm">
                        <div class="form-group">
                            <label for="district">District:</label>
                            <input type="text" id="district" required placeholder="Enter district name">
                        </div>
                        <div class="form-group">
                            <label for="season">Season:</label>
                            <select id="season" required>
                                <option value="">Select Season</option>
                                <option value="kharif">Kharif</option>
                                <option value="rabi">Rabi</option>
                                <option value="zaid">Zaid</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="soilType">Soil Type:</label>
                            <select id="soilType" required>
                                <option value="">Select Soil Type</option>
                                <option value="clay">Clay</option>
                                <option value="sandy">Sandy</option>
                                <option value="loamy">Loamy</option>
                                <option value="black">Black</option>
                                <option value="red">Red</option>
                            </select>
                        </div>
                        <button type="submit" class="button">Predict Rainfall</button>
                    </form>
                </div>
                <div id="rainPredictionResult" class="card hidden">
                    <h3>Prediction Results</h3>
                    <div id="predictionContent"></div>
                    <div class="chart-container">
                        <canvas id="rainChart"></canvas>
                    </div>
                    </div>
                </div>

            <!-- Crop Details Section -->
            <div id="crop-details" class="feature-section hidden">
                <div class="card">
                    <h2>Crop Details</h2>
                    <form id="cropDetailsForm">
                        <div class="form-group">
                            <label for="cropName">Enter Crop Name:</label>
                            <input type="text" id="cropName" required placeholder="e.g., Rice, Wheat, Cotton">
                        </div>
                        <button type="submit" class="button">Get Crop Details</button>
                    </form>
                </div>
                <div id="cropDetailsResult" class="card hidden">
                    <h3>Crop Information</h3>
                    <div id="cropDetailsContent"></div>
                </div>
                </div>

            <!-- Disease Detection Section -->
            <div id="disease-detection" class="feature-section hidden">
                <div class="card">
                    <h2>Disease Detection</h2>
                    <form id="diseaseDetectionForm">
                        <div class="form-group">
                            <label for="leafImage">Upload Leaf Image:</label>
                                    <input type="file" id="leafImage" accept="image/*" required>
                            </div>
                        <div id="imagePreview" class="hidden">
                            <img id="preview" src="" alt="Preview" style="max-width: 100%; margin-top: 10px;">
                        </div>
                        <button type="submit" class="button">Detect Disease</button>
                    </form>
                </div>
                <div id="diseaseDetectionResult" class="card hidden">
                    <h3>Detection Results</h3>
                    <div id="detectionContent"></div>
                    <div class="chart-container">
                        <canvas id="diseaseChart"></canvas>
                    </div>
                    </div>
                </div>

            <!-- Cost Estimator Section -->
            <div id="cost-estimator" class="feature-section hidden">
                <div class="card">
                    <h2>Cost Estimator</h2>
                    <form id="costEstimatorForm">
                        <div class="form-group">
                            <label for="landArea">Land Area (in acres):</label>
                            <input type="number" id="landArea" required min="0" step="0.1" placeholder="Enter land area">
                        </div>
                        <div class="form-group">
                            <label for="cropType">Crop Type:</label>
                            <select id="cropType" required>
                                <option value="">Select Crop</option>
                            </select>
                        </div>
                        <button type="submit" class="button">Calculate Costs</button>
                    </form>
                </div>
                <div id="costEstimationResult" class="card hidden">
                    <h3>Cost Estimation Results</h3>
                    <div id="costContent"></div>
                    <div class="chart-container">
                        <canvas id="costChart"></canvas>
            </div>
                </div>
                </div>

            <!-- Plant Health Section -->
            <div id="plant-health" class="feature-section hidden">
                <div class="card">
                    <h2>Plant Health Analysis</h2>
                    <form id="plantHealthForm">
                        <div class="form-group">
                            <label for="plantImage">Upload Plant Image:</label>
                            <input type="file" id="plantImage" accept="image/*" required>
                </div>
                        <div id="plantImagePreview" class="hidden">
                            <img id="plantPreview" src="" alt="Preview" style="max-width: 100%; margin-top: 10px;">
            </div>
                        <button type="submit" class="button">Analyze Plant Health</button>
                    </form>
        </div>
                <div id="plantHealthResult" class="card hidden">
                    <h3>Analysis Results</h3>
                    <div id="plantHealthContent"></div>
    </div>
    </div>
        </div>
    </div>

    <script>
        // Function to show selected feature and hide others
        function showFeature(featureId) {
            // Hide all feature sections
            document.querySelectorAll('.feature-section').forEach(section => {
                section.classList.add('hidden');
            });
            // Show selected feature section
            document.getElementById(featureId).classList.remove('hidden');
        }

        // Initialize the first feature
        showFeature('crop-recommendation');

        // Add event listeners and form handling for each feature
        // Crop Recommendation Form
        document.getElementById('cropRecommendationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = {
                nitrogen: parseFloat(document.getElementById('nitrogen').value),
                phosphorus: parseFloat(document.getElementById('phosphorus').value),
                potassium: parseFloat(document.getElementById('potassium').value),
                temperature: parseFloat(document.getElementById('temperature').value),
                humidity: parseFloat(document.getElementById('humidity').value),
                ph: parseFloat(document.getElementById('ph').value),
                rainfall: parseFloat(document.getElementById('rainfall').value)
            };

            try {
                const response = await fetch('/api/recommend-crop', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                const data = await response.json();
                
                const resultSection = document.getElementById('cropRecommendationResult');
                const resultContent = document.getElementById('recommendationContent');
                
                if (response.ok) {
                    resultContent.innerHTML = `
                        <div class="details-section">
                            <h5>Recommended Crops and Actions</h5>
                            <ul>
                                ${data.recommendations.map(recommendation => `<li>${recommendation}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="details-section">
                            <h5>Soil Analysis</h5>
                            <p><strong>Nitrogen Level:</strong> ${formData.nitrogen} (${data.nitrogen_status})</p>
                            <p><strong>Phosphorus Level:</strong> ${formData.phosphorus} (${data.phosphorus_status})</p>
                            <p><strong>Potassium Level:</strong> ${formData.potassium} (${data.potassium_status})</p>
                        </div>
                    `;

                    // Create soil parameters chart
                    const ctx = document.getElementById('soilChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: ['Nitrogen', 'Phosphorus', 'Potassium'],
                            datasets: [{
                                data: [formData.nitrogen, formData.phosphorus, formData.potassium],
                                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56']
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                },
                                title: {
                                    display: true,
                                    text: 'Soil Parameters Distribution'
                                }
                            }
                        }
                    });

                    resultSection.classList.remove('hidden');
                } else {
                    resultContent.innerHTML = `<p class="error">${data.error || 'Failed to get recommendations'}</p>`;
                    resultSection.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error:', error);
                resultContent.innerHTML = '<p class="error">An error occurred while getting recommendations</p>';
                resultSection.classList.remove('hidden');
            }
        });

        // Rain Prediction Form
        document.getElementById('rainPredictionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = {
                district: document.getElementById('district').value,
                season: document.getElementById('season').value,
                soil_type: document.getElementById('soilType').value
            };

            try {
                const response = await fetch('/api/predict-rain', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                const data = await response.json();
                
                const resultSection = document.getElementById('rainPredictionResult');
                const resultContent = document.getElementById('predictionContent');
                
                if (response.ok) {
                    resultContent.innerHTML = `
                        <div class="details-section">
                            <h5>Rainfall Prediction</h5>
                        <p><strong>Expected Rainfall:</strong> ${data.expected_rainfall} mm</p>
                            <p><strong>Probability of Rain:</strong> ${data.rain_probability}%</p>
                        </div>
                        <div class="details-section">
                            <h5>Recommended Crops</h5>
                            <ul>
                                ${data.recommended_crops.map(crop => `<li>${crop}</li>`).join('')}
                        </ul>
                        </div>
                        <div class="details-section">
                            <h5>Additional Tips</h5>
                            <p>${data.additional_tips}</p>
                        </div>
                    `;

                    // Create rain prediction chart
                    const ctx = document.getElementById('rainChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: ['Expected Rainfall', 'Rain Probability'],
                            datasets: [{
                                data: [data.expected_rainfall, data.rain_probability],
                                backgroundColor: ['#36A2EB', '#FFCE56']
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                },
                                title: {
                                    display: true,
                                    text: 'Rainfall Prediction'
                                }
                            }
                        }
                    });

                    resultSection.classList.remove('hidden');
                } else {
                    resultContent.innerHTML = `<p class="error">${data.error || 'Failed to predict rainfall'}</p>`;
                    resultSection.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error:', error);
                resultContent.innerHTML = '<p class="error">An error occurred while predicting rainfall</p>';
                resultSection.classList.remove('hidden');
            }
        });

        // Crop Details Form
        document.getElementById('cropDetailsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const cropName = document.getElementById('cropName').value;

            try {
                const response = await fetch('/api/crop-details', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ crop_name: cropName })
                });
                const data = await response.json();

                const resultSection = document.getElementById('cropDetailsResult');
                const resultContent = document.getElementById('cropDetailsContent');
                
                if (response.ok) {
                    resultContent.innerHTML = `
                        <div class="details-section">
                            <h5>Growing Information</h5>
                            <p><strong>Growing Season:</strong> ${data.growing_season}</p>
                            <p><strong>Growing Duration:</strong> ${data.growing_duration}</p>
                            <p><strong>Optimal Temperature:</strong> ${data.optimal_temperature}</p>
                            <p><strong>Water Requirements:</strong> ${data.water_requirements}</p>
                        </div>
                        <div class="details-section">
                            <h5>Fertilizer Recommendations</h5>
                            <ul>
                                ${data.fertilizer_recommendations.map(fertilizer => `
                                    <li>
                                        <strong>${fertilizer.name}:</strong> ${fertilizer.amount} per acre
                                        <br>
                                        <small>${fertilizer.description}</small>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        <div class="details-section">
                            <h5>Growing Tips</h5>
                            <ul>
                                ${data.growing_tips.map(tip => `<li>${tip}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="details-section">
                            <h5>Pest Control</h5>
                            <ul>
                                ${data.pest_control.map(pest => `
                                    <li>
                                        <strong>${pest.name}:</strong>
                                        <br>
                                        <small>${pest.description}</small>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        <div class="details-section">
                            <h5>Market Information</h5>
                            <p><strong>Average Market Price:</strong> ₹${data.market_price} per kg</p>
                            <p><strong>Yield per Acre:</strong> ${data.yield_per_acre}</p>
                        </div>
                    `;
                    resultSection.classList.remove('hidden');
                } else {
                    resultContent.innerHTML = `<p class="error">${data.error || 'Failed to get crop details'}</p>`;
                    resultSection.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error:', error);
                resultContent.innerHTML = '<p class="error">An error occurred while getting crop details</p>';
                resultSection.classList.remove('hidden');
            }
        });

        // Disease Detection Form
        document.getElementById('diseaseDetectionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData();
            const imageFile = document.getElementById('leafImage').files[0];
            formData.append('image', imageFile);

            try {
                const response = await fetch('/api/detect-disease', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                
                const resultSection = document.getElementById('diseaseDetectionResult');
                const resultContent = document.getElementById('detectionContent');
                
                if (response.ok) {
                    resultContent.innerHTML = `
                        <div class="details-section">
                            <h5>Detection Results</h5>
                            <p><strong>Disease Name:</strong> ${data.disease_name}</p>
                            <p><strong>Confidence Level:</strong> ${data.confidence}%</p>
                            <p><strong>Description:</strong> ${data.description}</p>
                        </div>
                        <div class="details-section">
                            <h5>Treatment</h5>
                            <p>${data.treatment}</p>
                        </div>
                        <div class="details-section">
                            <h5>Prevention</h5>
                            <p>${data.prevention}</p>
                        </div>
                    `;

                    // Create disease detection chart
                    const ctx = document.getElementById('diseaseChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: ['Confidence', 'Remaining'],
                            datasets: [{
                                data: [data.confidence, 100 - data.confidence],
                                backgroundColor: ['#FF6384', '#C9CBCF']
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                },
                                title: {
                                    display: true,
                                    text: 'Disease Detection Confidence'
                                }
                            }
                        }
                    });

                    resultSection.classList.remove('hidden');
                } else {
                    resultContent.innerHTML = `<p class="error">${data.error || 'Failed to detect disease'}</p>`;
                    resultSection.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error:', error);
                resultContent.innerHTML = '<p class="error">An error occurred while detecting disease</p>';
                resultSection.classList.remove('hidden');
            }
        });

        // Cost Estimator Form
        document.getElementById('costEstimatorForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = {
                land_area: parseFloat(document.getElementById('landArea').value),
                crop_type: document.getElementById('cropType').value
            };
            
            try {
                const response = await fetch('/api/estimate-cost', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                const data = await response.json();
                
                const resultSection = document.getElementById('costEstimationResult');
                const resultContent = document.getElementById('costContent');
                
                if (response.ok) {
                    resultContent.innerHTML = `
                        <div class="details-section">
                            <h5>Input Requirements</h5>
                            <ul>
                                <li><strong>Seeds Required:</strong> ${data.seed_quantity} kg</li>
                                <li><strong>Fertilizer Required:</strong> ${data.fertilizer_quantity} kg</li>
                                <li><strong>Labor Days Required:</strong> ${data.labor_days} days</li>
                                <li><strong>Pesticide Required:</strong> ${data.pesticide_quantity} liters</li>
                            </ul>
                        </div>
                        <div class="details-section">
                            <h5>Cost Breakdown</h5>
                            <ul>
                                <li><strong>Seeds Cost:</strong> ₹${data.seed_cost.toFixed(2)}</li>
                                <li><strong>Fertilizer Cost:</strong> ₹${data.fertilizer_cost.toFixed(2)}</li>
                                <li><strong>Labor Cost:</strong> ₹${data.labor_cost.toFixed(2)}</li>
                                <li><strong>Irrigation Cost:</strong> ₹${data.irrigation_cost.toFixed(2)}</li>
                                <li><strong>Pesticide Cost:</strong> ₹${data.pesticide_cost.toFixed(2)}</li>
                                <li><strong>Machinery Cost:</strong> ₹${data.machinery_cost.toFixed(2)}</li>
                                <li><strong>Miscellaneous Cost:</strong> ₹${data.miscellaneous_cost.toFixed(2)}</li>
                            </ul>
                            <h5>Total Cost: ₹${data.total_cost.toFixed(2)}</h5>
                            <h5>Cost per Acre: ₹${data.cost_per_acre.toFixed(2)}</h5>
                        </div>
                        <div class="details-section">
                            <h5>Expected Returns</h5>
                            <ul>
                                <li><strong>Expected Yield:</strong> ${data.expected_yield} tons</li>
                                <li><strong>Expected Revenue:</strong> ₹${data.expected_revenue.toFixed(2)}</li>
                                <li><strong>Expected Profit:</strong> ₹${data.expected_profit.toFixed(2)}</li>
                                <li><strong>Expected Profit Margin:</strong> ${data.profit_margin.toFixed(1)}%</li>
                            </ul>
                        </div>
                        <div class="details-section">
                            <h5>Additional Information</h5>
                            <p>${data.additional_info}</p>
                        </div>
                    `;

                    // Create cost breakdown chart
                    const ctx = document.getElementById('costChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: ['Seed', 'Fertilizer', 'Labor', 'Irrigation', 'Pesticide', 'Machinery', 'Misc'],
                            datasets: [{
                                data: [
                                    data.seed_cost,
                                    data.fertilizer_cost,
                                    data.labor_cost,
                                    data.irrigation_cost,
                                    data.pesticide_cost,
                                    data.machinery_cost,
                                    data.miscellaneous_cost
                                ],
                                backgroundColor: [
                                    '#FF6384',
                                    '#36A2EB',
                                    '#FFCE56',
                                    '#4BC0C0',
                                    '#9966FF',
                                    '#FF9F40',
                                    '#C9CBCF'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                },
                                title: {
                                    display: true,
                                    text: 'Cost Distribution (₹)'
                                }
                            }
                        }
                    });

                    resultSection.classList.remove('hidden');
                } else {
                    resultContent.innerHTML = `<p class="error">${data.error || 'Failed to estimate costs'}</p>`;
                    resultSection.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error:', error);
                resultContent.innerHTML = '<p class="error">An error occurred while estimating costs</p>';
                resultSection.classList.remove('hidden');
            }
        });

        // Plant Health Form
        document.getElementById('plantHealthForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData();
            const imageFile = document.getElementById('plantImage').files[0];
            formData.append('image', imageFile);

            try {
                const response = await fetch('/api/analyze-plant', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                
                const resultSection = document.getElementById('plantHealthResult');
                const resultContent = document.getElementById('plantHealthContent');
                
                if (response.ok) {
                    resultContent.innerHTML = `
                        <div class="details-section">
                            <h5>Health Analysis</h5>
                            <p><strong>Health Status:</strong> ${data.health_status}</p>
                        </div>
                        <div class="details-section">
                            <h5>Detected Issues</h5>
                            <ul>
                                ${Array.isArray(data.detected_issues) ? 
                                    data.detected_issues.map(issue => `<li>${issue}</li>`).join('') : 
                                    `<li>${data.detected_issues}</li>`}
                            </ul>
                        </div>
                        <div class="details-section">
                            <h5>Recommended Fertilizers</h5>
                        <ul>
                            ${data.recommended_fertilizers.map(fertilizer => `
                                <li>
                                        <strong>${fertilizer.name}:</strong> ${fertilizer.amount}
                                        <br>
                                        <small>${fertilizer.application}</small>
                                </li>
                            `).join('')}
                        </ul>
                        </div>
                        <div class="details-section">
                            <h5>Additional Recommendations</h5>
                            <p>${data.additional_recommendations}</p>
                        </div>
                    `;
                    resultSection.classList.remove('hidden');
                } else {
                    resultContent.innerHTML = `<p class="error">${data.error || 'Failed to analyze plant health'}</p>`;
                    resultSection.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error:', error);
                resultContent.innerHTML = '<p class="error">An error occurred while analyzing plant health</p>';
                resultSection.classList.remove('hidden');
            }
        });

        // Image preview for disease detection
        document.getElementById('leafImage').addEventListener('change', function(e) {
            const preview = document.getElementById('preview');
            const previewDiv = document.getElementById('imagePreview');
            const file = e.target.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    previewDiv.classList.remove('hidden');
                }
                reader.readAsDataURL(file);
            } else {
                previewDiv.classList.add('hidden');
            }
        });

        // Image preview for plant health
        document.getElementById('plantImage').addEventListener('change', function(e) {
            const preview = document.getElementById('plantPreview');
            const previewDiv = document.getElementById('plantImagePreview');
            const file = e.target.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    previewDiv.classList.remove('hidden');
                }
                reader.readAsDataURL(file);
            } else {
                previewDiv.classList.add('hidden');
            }
        });

        // Populate cost estimator crops
        async function populateCostEstimatorCrops() {
            try {
                const response = await fetch('/api/cost-estimator-crops');
                if (!response.ok) {
                    console.error('Failed to fetch cost estimator crops', response.statusText);
                    return;
                }
                const crops = await response.json();
                const cropSelect = document.getElementById('cropType');
                
                // Clear existing options except the first (default)
                cropSelect.innerHTML = '<option value="">Select Crop</option>';
                
                // Add fetched crops to the dropdown
                crops.forEach(crop => {
                    const option = document.createElement('option');
                    option.value = crop.toLowerCase();
                    option.textContent = crop.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                    cropSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching cost estimator crops:', error);
            }
        }

        // Call the function to populate crops when the page loads
        populateCostEstimatorCrops();
    </script>
</body>
</html> 