<!DOCTYPE html>
<html>
<head>
    <title>Cost Estimator - Agriculture System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)),
                        url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #333;
        }
        .header {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        .welcome {
            font-size: 24px;
        }
        .back-button {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            transition: background-color 0.3s;
        }
        .back-button:hover {
            background-color: #2980b9;
        }
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        .card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #34495e;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .button {
            background-color: #27ae60;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            width: 100%;
        }
        .button:hover {
            background-color: #219a52;
        }
        .details-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .details-section h5 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 10px;
            border-bottom: 2px solid #27ae60;
            padding-bottom: 5px;
        }
        .details-section ul {
            list-style-type: none;
            padding-left: 0;
            margin: 5px 0;
        }
        .details-section li {
            margin-bottom: 8px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 4px;
        }
        .chart-container {
            width: 100%;
            max-width: 600px;
            margin: 20px auto;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="header">
        <div class="welcome">Cost Estimator</div>
        <a href="/dashboard" class="back-button">Back to Dashboard</a>
    </div>

    <div class="container">
        <div class="card">
            <h2>Calculate Farming Costs</h2>
            <form id="costEstimatorForm">
                <div class="form-group">
                    <label for="landArea">Land Area (in acres):</label>
                    <input type="number" id="landArea" required min="0" step="0.1" placeholder="Enter land area">
                </div>
                <div class="form-group">
                    <label for="cropType">Crop Type:</label>
                    <select id="cropType" required>
                        <option value="">Select Crop</option>
                    </select>
                </div>
                <button type="submit" class="button">Calculate Costs</button>
            </form>
        </div>

        <div id="costEstimationResult" style="display: none;">
            <div class="card">
                <h3>Cost Estimation Results</h3>
                <div id="resultContent"></div>
                <div class="chart-container">
                    <canvas id="costChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Function to populate crop type dropdown
        async function populateCostEstimatorCrops() {
            try {
                const response = await fetch('/api/cost-estimator-crops');
                if (!response.ok) {
                    console.error('Failed to fetch cost estimator crops', response.statusText);
                    return;
                }
                const crops = await response.json();
                const cropSelect = document.getElementById('cropType');
                
                // Clear existing options except the first (default)
                cropSelect.innerHTML = '<option value="">Select Crop</option>';
                
                // Add fetched crops to the dropdown
                crops.forEach(crop => {
                    const option = document.createElement('option');
                    option.value = crop.toLowerCase();
                    option.textContent = crop.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                    cropSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching cost estimator crops:', error);
            }
        }

        // Call the function to populate crops when the page loads
        populateCostEstimatorCrops();

        document.getElementById('costEstimatorForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = {
                land_area: parseFloat(document.getElementById('landArea').value),
                crop_type: document.getElementById('cropType').value
            };

            try {
                const response = await fetch('/api/estimate-cost', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                const data = await response.json();
                
                const resultSection = document.getElementById('costEstimationResult');
                const resultContent = document.getElementById('resultContent');
                
                if (response.ok) {
                    resultContent.innerHTML = `
                        <div class="details-section">
                            <h5>Input Requirements</h5>
                            <ul>
                                <li><strong>Seeds Required:</strong> ${data.seed_quantity} kg</li>
                                <li><strong>Fertilizer Required:</strong> ${data.fertilizer_quantity} kg</li>
                                <li><strong>Labor Days Required:</strong> ${data.labor_days} days</li>
                                <li><strong>Pesticide Required:</strong> ${data.pesticide_quantity} liters</li>
                            </ul>
                        </div>
                        <div class="details-section">
                            <h5>Cost Breakdown</h5>
                            <ul>
                                <li><strong>Seeds Cost:</strong> ₹${data.seed_cost.toFixed(2)}</li>
                                <li><strong>Fertilizer Cost:</strong> ₹${data.fertilizer_cost.toFixed(2)}</li>
                                <li><strong>Labor Cost:</strong> ₹${data.labor_cost.toFixed(2)}</li>
                                <li><strong>Irrigation Cost:</strong> ₹${data.irrigation_cost.toFixed(2)}</li>
                                <li><strong>Pesticide Cost:</strong> ₹${data.pesticide_cost.toFixed(2)}</li>
                                <li><strong>Machinery Cost:</strong> ₹${data.machinery_cost.toFixed(2)}</li>
                                <li><strong>Miscellaneous Cost:</strong> ₹${data.miscellaneous_cost.toFixed(2)}</li>
                            </ul>
                            <h5>Total Cost: ₹${data.total_cost.toFixed(2)}</h5>
                            <h5>Cost per Acre: ₹${data.cost_per_acre.toFixed(2)}</h5>
                        </div>
                        <div class="details-section">
                            <h5>Expected Returns</h5>
                            <ul>
                                <li><strong>Expected Yield:</strong> ${data.expected_yield} tons</li>
                                <li><strong>Expected Revenue:</strong> ₹${data.expected_revenue.toFixed(2)}</li>
                                <li><strong>Expected Profit:</strong> ₹${data.expected_profit.toFixed(2)}</li>
                                <li><strong>Expected Profit Margin:</strong> ${data.profit_margin.toFixed(1)}%</li>
                            </ul>
                        </div>
                        <div class="details-section">
                            <h5>Additional Information</h5>
                            <p>${data.additional_info}</p>
                        </div>
                    `;

                    // Create pie chart for cost breakdown
                    const ctx = document.getElementById('costChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: ['Seed', 'Fertilizer', 'Labor', 'Irrigation', 'Pesticide', 'Machinery', 'Misc'],
                            datasets: [{
                                data: [
                                    data.seed_cost,
                                    data.fertilizer_cost,
                                    data.labor_cost,
                                    data.irrigation_cost,
                                    data.pesticide_cost,
                                    data.machinery_cost,
                                    data.miscellaneous_cost
                                ],
                                backgroundColor: [
                                    '#FF6384',
                                    '#36A2EB',
                                    '#FFCE56',
                                    '#4BC0C0',
                                    '#9966FF',
                                    '#FF9F40',
                                    '#C9CBCF'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                },
                                title: {
                                    display: true,
                                    text: 'Cost Distribution (₹)'
                                }
                            }
                        }
                    });

                    resultSection.style.display = 'block';
                } else {
                    resultContent.innerHTML = `<p class="error">${data.error || 'Failed to estimate costs'}</p>`;
                    resultSection.style.display = 'block';
                }
            } catch (error) {
                console.error('Error:', error);
                resultContent.innerHTML = '<p class="error">An error occurred while estimating costs</p>';
                resultSection.style.display = 'block';
            }
        });
    </script>
</body>
</html> 